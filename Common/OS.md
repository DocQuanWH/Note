# 操作系统

## 1. 进程和线程
### 1.1. 进程
**进程**表示**资源分配**的基本单位，也是**调度运行**的基本单位。当用户运行一个程序：
1. 操作系统就会为该程序创建一个进程，分配相关资源
2. 进程调度程序运行该程序，并分配CPU资源及其它相关资源

但在**微内核**中，**进程**的功能变成了**资源分配的单位**，而**线程**才是真正**调度的单位**。

### 1.2 线程
线程是进程中执行预算的最小单位。如果将进程理解为操作系统的一次任务，那么线程就是该任务的一系列子任务。引入线程的好处如下：
1. 提高并发性：进程可以创建多个进程同时执行一些任务
2. 线程切换的所需开销较小（上下文数据小，所需资源较小）

### 1.2 进程和线程
1. 一个线程只能属于一个线程，一个进程可以创建多个线程
2. 资源分配给进程，同一进程的所有线程共享进程所有资源

## 2. 进程/线程同步
进程和线程之间的同步机制有四种：
1. **临界区（Critical Section）**：线程串行的访问公共资源或代码，任意时刻只允许一个线程对共享资源进行访问，其它线程想必须等到该线程结束后才能对其进行抢占。
2. **互斥量（Mutex）**：只有拥有**互斥对象**线程才能访问公共资源。因为互斥对象唯一，因此保证公共资源不会同时被多个线程访问。

> **互斥量**和**临界区**的作用相似，但互斥量可以跨线程/线程使用，因此互斥量需要更多的资源。因xi此，**临界区更适合只在进程内部同步的使用场景**。

3. **信号量（Semaphore）**：它允许多个线程同一时刻访问同一资源，但限制同时访问该资源的最大数量。
4. **事件（Event）**：通过通知操作的方式保持线程的同步，还可以方便实现对多个线程的优先级比较。

## 3. 进程/线程通信：TODO

## 4. 死锁预防

## 5. 系统调用和库函数的区别？
* **系统调用**：操作系统为程序与硬件设备进行交互而专门提供的接口，发生在内核空间。
* **库函数**：将一些常用的函数编写完后放到一个文件中，发生在用户空间。

因为不同操作系统的系统实现不一样，因此移植性较差。同时，系统调用需要切换内核空间，因此开销较大。

## 6. 守护、僵尸、孤儿进程的概念
* **守护进程**：运行在后台的一种特殊进程，独立于控制终端并周期性地执行某些任务。
* **僵尸进程**：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程（危害：如果进程不调用wait / waitpid的话， 那么保留的那段信息就不会释放，其进程号就会一直被占用，但是系统所能使用的进程号是有限的，如果大量的产生僵死进程，将因为没有可用的进程号而导致系统不能产生新的进程. 此即为僵尸进程的危害，应当避免）。
* **孤儿进程**：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作（init进程就会代表党和政府出面处理它的一切善后工作，因此孤儿进程并不会有什么危害）。
