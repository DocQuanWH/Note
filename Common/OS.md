# 操作系统

## 1. 进程和线程
* **进程**是程序一次执行的实例，是操作系统**资源分配**的基本单位（代码、数据、栈、运行时信息）。
* **线程**是轻量级的进程，是操作系统**调度和执行**的基本单位。
* 一个线程只能属于一个进程，一个进程可以创建多个线程。
* 线程相对进程切换的所需开销较小。

## 2. 进程/线程同步
进程和线程之间的同步机制有四种：
1. **临界区（Critical Section）**：线程串行的访问公共资源或代码，任意时刻只允许一个线程对共享资源进行访问，其它线程想必须等到该线程结束后才能对其进行抢占。
2. **互斥量（Mutex）**：只有拥有**互斥对象**线程才能访问公共资源。因为互斥对象唯一，因此保证公共资源不会同时被多个线程访问。

> **互斥量**和**临界区**的作用相似，但互斥量可以跨线程/线程使用，因此互斥量需要更多的资源。因此，**临界区更适合只在进程内部同步的使用场景**。

3. **信号量（Semaphore）**：它允许多个线程同一时刻访问同一资源，但限制同时访问该资源的最大数量。
4. **事件（Event）**：通过通知操作的方式保持线程的同步，还可以方便实现对多个线程的优先级比较。

## 3. 进程/线程通信
* **管道**：数据只能单向流动
* **套接字**
* **信号量**：信号量允许多个进程对共享资源进行访问，因此可以用来进行进程间通信
* **共享内存**：共享内存由一个进程创建，但多个进程都可以访问
* **消息队列**：消息队列是有消息的链表，存放在内核中并由消息队列标识符标识

## 4. 死锁
* **死锁**：一个进程集合中的多个进程因资源竞争而造成互相等待的现象
* **死锁必要条件**：
    - 互斥条件：资源不能被共享，只能由一个进程使用
    - 请求和保持条件：已得到资源的进程可以再次申请新的资源
    - 非剥夺条件：已经分配的资源不能从相应的进程中被强制剥夺
    - 循环等待条件：系统中若干进程组成环路，该环路中每个进程都在等待相邻进程正占用的资源
* **死锁处理策略**：
    - 忽略该问题，如window进程管理器直接关闭该进程
    - 检测死锁并回复
    - 通过对资源有序分配，避免环路发生
    - 破坏死锁必要条件，来预防死锁的产生

## 5. 系统调用和库函数的区别？
* **系统调用**：操作系统为程序与硬件设备进行交互而专门提供的接口，发生在内核空间。
* **库函数**：将一些常用的函数编写完后放到一个文件中，发生在用户空间。

因为不同操作系统的系统实现不一样，因此移植性较差。同时，系统调用需要切换内核空间，因此开销较大。

## 6. 守护、僵尸、孤儿进程的概念
* **守护进程**：运行在后台的一种特殊进程，独立于控制终端并周期性地执行某些任务。
* **僵尸进程**：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程（危害：如果进程不调用wait / waitpid的话， 那么保留的那段信息就不会释放，其进程号就会一直被占用，但是系统所能使用的进程号是有限的，如果大量的产生僵死进程，将因为没有可用的进程号而导致系统不能产生新的进程. 此即为僵尸进程的危害，应当避免）。
* **孤儿进程**：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作（init进程就会代表党和政府出面处理它的一切善后工作，因此孤儿进程并不会有什么危害）。

## 7. select和epoll
**select**和**epoll**都来实现**I/O多路复用技术**的Linux接口，**I/O多路复用技术**是指：
> 当系统中某个I/O可用时，内核会通知相应进程该I/O可用，从而不会因为等待I/O操作而阻塞。
相比**多线程技术**，**I/O多路复用技术**系统开销较小（不必维护多线程）。



### Linux
* **Shell**分为**内部命令**（exit、cd等）和**外部命令**（可执行程序，ls、vi等），外部命令通常存放在`/bin`、`/usr/bin`等目录下。
* **grep命令**：是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来，命令格式`grep [pattern] file`。
* **文件权限**：**owner/group/others**，**r-4、w-2、x-1**。
* **文件**：**普通文件、目录文件、链接文件和设备文件**
* **文件描述符**：内核利用**文件描述符**来访问**文件**，文件描述符为非负整数。打开或者新建文件时，内核都会为这些文件分配文件描述符。通常文件描述符的前三个为**标准输入0、标准输出1和标准错误2**。
* **文件描述符对性能的影响**：文件描述符的上限默认为1024，如果对繁忙的web服务器，肯能导致文件描述符不够用而导致无法访问新的文件。可以通过`ulimit`命令临时或`/etc/security/nf`配置文件永久增加文件描述符数量。
